# [truncated for brevity, full code will be inserted here as in the updated textdoc]